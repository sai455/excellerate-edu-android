"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1213],{1213:(de,y,a)=>{a.r(y),a.d(y,{DMSPageModule:()=>ne});var h=a(177),f=a(4341),r=a(3465),v=a(9522),_=a(467),N=a(3125),g=a(1626),u=a(1840),S=a(2163),D=a(5121),P=a(3319),e=a(4438),k=a(3656),C=a(252),M=a(3144),G=a(9684),x=a(3644),j=a(2571),b=a(369),F=a(6886),T=a(5493);const R=["userInput"],X=()=>[0,1,2,3,4,5,6,7,8,9,10];function A(s,c){if(1&s){const t=e.RV6();e.j41(0,"ion-searchbar",8),e.bIt("keyup",function(i){e.eBV(t);const o=e.XpG();return e.Njj(o.onGallerySearchKeyUp(i))}),e.k0s()}if(2&s){const t=e.XpG();e.Mz_("placeholder","Search in ",t.galleryNavs[t.galleryNavs.length-1].FolderName,"")}}function $(s,c){1&s&&(e.j41(0,"ion-card")(1,"ion-row")(2,"ion-col",10),e.nrm(3,"ion-skeleton-text",11),e.k0s()(),e.j41(4,"ion-row")(5,"ion-col",10),e.nrm(6,"ion-skeleton-text",11),e.k0s()(),e.j41(7,"ion-row")(8,"ion-col",10),e.nrm(9,"ion-skeleton-text",11),e.k0s()(),e.j41(10,"ion-row")(11,"ion-col",10),e.nrm(12,"ion-skeleton-text",11),e.k0s()(),e.j41(13,"ion-row")(14,"ion-col",10),e.nrm(15,"ion-skeleton-text",11),e.k0s()(),e.j41(16,"ion-row",12)(17,"ion-col",13),e.nrm(18,"ion-skeleton-text",11),e.k0s()()())}function B(s,c){1&s&&(e.j41(0,"div")(1,"ion-list"),e.DNE(2,$,19,0,"ion-card",9),e.k0s()()),2&s&&(e.R7$(2),e.Y8G("ngForOf",e.lJ4(1,X)))}function U(s,c){if(1&s){const t=e.RV6();e.j41(0,"ion-list")(1,"ion-item",14)(2,"ion-avatar",15)(3,"img",16),e.bIt("click",function(){const i=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.openNode(i.NodeId,i.NodeName,i.NodeCategoryId))}),e.k0s()(),e.j41(4,"ion-label",17),e.bIt("click",function(){const i=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.openNode(i.NodeId,i.NodeName,i.NodeCategoryId))}),e.EFF(5),e.k0s()()()}if(2&s){const t=c.$implicit,n=e.XpG(2);e.R7$(3),e.Y8G("src",n.trayImage,e.B4B),e.R7$(2),e.SpI(" ",t.NodeName," ")}}function V(s,c){if(1&s&&(e.j41(0,"div"),e.DNE(1,U,6,2,"ion-list",9),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.allNodes)}}function E(s,c){if(1&s){const t=e.RV6();e.j41(0,"ion-fab",18)(1,"ion-fab-button",19),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.presentActionSheet())}),e.nrm(2,"ion-icon",20),e.k0s()()}}function w(s,c){if(1&s){const t=e.RV6();e.j41(0,"ion-button",23),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.backToAllNode())}),e.nrm(1,"ion-icon",24),e.EFF(2," Back "),e.k0s()}}function Y(s,c){if(1&s){const t=e.RV6();e.j41(0,"ion-button",23),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.getGalleryData(i.galleryNavs[i.galleryNavs.length-2].NodeId,i.galleryNavs[i.galleryNavs.length-2].FolderName,!0,null))}),e.nrm(1,"ion-icon",24),e.EFF(2),e.k0s()}if(2&s){const t=e.XpG(2);e.R7$(2),e.SpI(" ",t.galleryNavs[t.galleryNavs.length-1].FolderName," ")}}function O(s,c){if(1&s){const t=e.RV6();e.j41(0,"ion-icon",32),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2).$implicit,o=e.XpG(2);return e.Njj(o.openEditFileNamePopup(i.NodeId,i.NodeName))}),e.k0s()}}function z(s,c){if(1&s){const t=e.RV6();e.j41(0,"ion-icon",33),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2).$implicit,o=e.XpG(2);return e.Njj(o.openSearchModal(i.NodeId,i.NodeName,!0))}),e.k0s()}}function L(s,c){if(1&s){const t=e.RV6();e.j41(0,"ion-icon",34),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2).$implicit,o=e.XpG(2);return e.Njj(o.presentAlertConfirm(i.NodeId,!0))}),e.k0s()}}function J(s,c){if(1&s){const t=e.RV6();e.j41(0,"ion-item",14)(1,"ion-avatar",27),e.bIt("click",function(){e.eBV(t);const i=e.XpG().$implicit,o=e.XpG(2);return e.Njj(o.openFile(i.FileUrl,i.Ext,i.FileName))}),e.nrm(2,"img",28),e.k0s(),e.j41(3,"ion-label",17),e.bIt("click",function(){e.eBV(t);const i=e.XpG().$implicit,o=e.XpG(2);return e.Njj(o.openFile(i.FileUrl,i.Ext,i.FileName))}),e.EFF(4),e.k0s(),e.DNE(5,O,1,0,"ion-icon",29)(6,z,1,0,"ion-icon",30)(7,L,1,0,"ion-icon",31),e.k0s()}if(2&s){const t=e.XpG().$implicit;e.R7$(2),e.Y8G("src",t.FileUrl,e.B4B),e.R7$(2),e.SpI(" ",t.NodeName," "),e.R7$(),e.Y8G("ngIf",t.Modify),e.R7$(),e.Y8G("ngIf",t.Modify),e.R7$(),e.Y8G("ngIf",t.Modify)}}function W(s,c){if(1&s){const t=e.RV6();e.j41(0,"ion-icon",33),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2).$implicit,o=e.XpG(2);return e.Njj(o.openSearchModal(i.NodeId,i.NodeName,!1))}),e.k0s()}}function Q(s,c){if(1&s){const t=e.RV6();e.j41(0,"ion-icon",34),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2).$implicit,o=e.XpG(2);return e.Njj(o.presentAlertConfirm(i.NodeId,!0))}),e.k0s()}}function K(s,c){if(1&s){const t=e.RV6();e.j41(0,"ion-item",35)(1,"ion-avatar",27),e.bIt("click",function(){e.eBV(t);const i=e.XpG().$implicit,o=e.XpG(2);return e.Njj(o.getGalleryData(i.NodeId,i.NodeName,null,null))}),e.nrm(2,"img",36),e.k0s(),e.j41(3,"ion-label",17),e.bIt("click",function(){e.eBV(t);const i=e.XpG().$implicit,o=e.XpG(2);return e.Njj(o.getGalleryData(i.NodeId,i.NodeName,!1,null))}),e.EFF(4),e.k0s(),e.DNE(5,W,1,0,"ion-icon",30)(6,Q,1,0,"ion-icon",31),e.k0s()}if(2&s){const t=e.XpG().$implicit,n=e.XpG(2);e.R7$(2),e.Y8G("src",n.folderImage,e.B4B),e.R7$(2),e.SpI(" ",t.NodeName," "),e.R7$(),e.Y8G("ngIf",t.Modify),e.R7$(),e.Y8G("ngIf",t.Modify)}}function H(s,c){if(1&s&&(e.j41(0,"ion-list"),e.DNE(1,J,8,5,"ion-item",25)(2,K,7,4,"ion-item",26),e.k0s()),2&s){const t=c.$implicit;e.R7$(),e.Y8G("ngIf",t.FileName.length>0),e.R7$(),e.Y8G("ngIf",0==t.FileName.length)}}function Z(s,c){1&s&&(e.j41(0,"div",37),e.EFF(1,"No files found."),e.k0s())}function q(s,c){if(1&s&&(e.j41(0,"div"),e.DNE(1,w,3,0,"ion-button",21)(2,Y,3,1,"ion-button",21)(3,H,3,2,"ion-list",9)(4,Z,2,0,"div",22),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.Y8G("ngIf",!t.isAPiCallInProcess&&t.galleryNavs&&1==t.galleryNavs.length),e.R7$(),e.Y8G("ngIf",!t.isAPiCallInProcess&&t.galleryNavs&&t.galleryNavs.length>1),e.R7$(),e.Y8G("ngForOf",t.data),e.R7$(),e.Y8G("ngIf",!t.isAPiCallInProcess&&t.data&&0==t.data.length)}}const ee=[{path:"",component:(()=>{class s{ngAfterViewInit(){this.userInputElement=this.userInputViewChild.nativeElement}constructor(t,n,i,o,l,d,m,p,I,oe,se,ae,le,re,ce){this.platform=t,this.file=n,this.fileTransfer=i,this.fileOpener=o,this.document=l,this.commonService=d,this.router=m,this.storage=p,this.apiCall=I,this.loadingController=oe,this.formBuilder=se,this.httpClient=ae,this.actionSheetController=le,this.modalController=re,this.alertController=ce,this.galleryImage=N.l.appImages.dms,this.trayImage=N.l.appImages.tray,this.folderImage=N.l.appImages.folder,this.heading="DMS",this.isBackRequired=!0,this.data=[],this.allNodes=[],this.dataMain=[],this.isAPiCallInProcess=!1,this.isErrorInApiCall=!1,this.galleryNavs=[],this.hasStudentRole=!0}ngOnInit(){this.getTopLevelNodes(),this.uploadForm=this.formBuilder.group({profile:[""]})}presentActionSheet(){var t=this;return(0,_.A)(function*(){let n=document.createElement("input");n.setAttribute("type","file"),n.setAttribute("style","position: relative; z-index: 99999; width: 100%; height: 100%; opacity: 0"),n.addEventListener("change",l=>{t.loadImageFromDevice(l)});const i=yield t.actionSheetController.create({header:"Add New Folder / File",backdropDismiss:!1,animated:!0,cssClass:"my-custom-class",buttons:[{text:"Document",icon:"document",role:"destructive",handler:()=>{t.userInputElement.click()}},{text:"Folder",role:"destructive",icon:"folder-open",handler:()=>{t.openModal()}},{text:"Cancel",icon:"close",role:"cancel",handler:()=>{}}]});yield i.present(),yield i.onDidDismiss()})()}presentAlertConfirm(t,n){var i=this;return(0,_.A)(function*(){yield(yield i.alertController.create({cssClass:"my-custom-class",header:"Confirm!",backdropDismiss:!1,message:"<strong>Are you sure you wish to delete ?</strong>",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:l=>{}},{text:"Okay",handler:()=>{i.RemoveNode(t,n)}}]})).present()})()}loadImageFromDevice(t){const n=t.target.files[0],i=new FileReader;i.readAsArrayBuffer(n);const o=new FormData;o.append("file",n),this.httpClient.post(u.h.urls.AddUserDMSFile+"/"+this.currentNodeId+"/"+this.userId+"/"+this.tenantShortName+"/"+this.nodeCategoryId,o).subscribe(d=>{this.commonService.presentToast("File Uploaded Successfully.",3e3,"success"),this.getGalleryData(this.currentNodeId,this.currentFolderName,null,this.nodeCategoryId)},d=>this.commonService.presentToast("An error occurred while processing, please try sometime later.",3e3,"danger")),i.onerror=d=>{}}presentLoading(){var t=this;return(0,_.A)(function*(){t.loading=yield t.loadingController.create({message:"Opening the document.."}),yield t.loading.present()})()}openModal(){var t=this;return(0,_.A)(function*(){let n=t.nodeCategoryId;const i=yield t.modalController.create({component:S.D,showBackdrop:!0,backdropDismiss:!1,cssClass:"my-custom-modal-css",componentProps:{modalTitle:"New Folder",userId:t.userId,tenantShortName:t.tenantShortName,nodeId:t.currentNodeId,nodeCategoryId:n}});return i.onDidDismiss().then(o=>{null!==o.data&&t.getGalleryData(t.currentNodeId,t.currentFolderName,null,t.nodeCategoryId)}),yield i.present()})()}openSearchModal(t,n,i){var o=this;return(0,_.A)(function*(){let l=o.nodeCategoryId;const d=yield o.modalController.create({component:D.r,showBackdrop:!0,backdropDismiss:!1,cssClass:"my-search-modal-css",componentProps:{modalTitle:"Permissions For "+n,userId:o.userId,tenantShortName:o.tenantShortName,nodeId:t,nodeCategoryId:l}});return d.onDidDismiss().then(m=>{null!==m.data&&o.getGalleryData(o.currentNodeId,o.currentFolderName,null,o.nodeCategoryId)}),yield d.present()})()}onGallerySearchKeyUp(t){let n=t.target.value;this.data=0==n.length?this.dataMain:this.dataMain.filter(i=>i.NodeName.toLocaleLowerCase().includes(n.toLocaleLowerCase()))}openEditFileNamePopup(t,n){this.openFileNameModal(t,n)}openFileNameModal(t,n){var i=this;return(0,_.A)(function*(){const o=yield i.modalController.create({component:P.l,showBackdrop:!0,backdropDismiss:!1,cssClass:"my-custom-modal-css",componentProps:{modalTitle:"Update File Name",tenantShortName:i.tenantShortName,nodeId:t,nodeName:n}});return o.onDidDismiss().then(l=>{null!==l.data&&i.getGalleryData(i.currentNodeId,i.currentFolderName,null,i.nodeCategoryId)}),yield o.present()})()}getTopLevelNodes(){this.storage.get("user").then(t=>{const n=JSON.parse(t);this.userId=n.UserId,n.Roles&&(this.hasStudentRole=!!n.Roles.includes("Student")),this.tenantShortName=n.TenantShortName;let i=new g.Nl;i=i.append("UserID",n.UserId),i=i.append("tenantName",n.TenantShortName),this.isAPiCallInProcess=!0,this.apiCall.login(u.h.urls.GetAllNodes,i).subscribe({next:o=>{this.isAPiCallInProcess=!1,this.isErrorInApiCall=!1,this.allNodes=o},error:o=>{this.isErrorInApiCall=!0,this.isAPiCallInProcess=!1}})})}openNode(t,n,i){this.getGalleryData(t,n,!1,i)}getGalleryData(t,n,i,o){this.currentNodeId=t,null!=o||null!=o?this.nodeCategoryId=o:o=this.nodeCategoryId,this.currentFolderName=n,null!=i&&(i?this.galleryNavs.pop():this.galleryNavs.push({NodeId:t,FolderName:n})),this.storage.get("user").then(l=>{const d=JSON.parse(l);this.userId=d.UserId,this.tenantShortName=d.TenantShortName;let m=new g.Nl;m=m.append("UserID",d.UserId),m=m.append("tenantName",d.TenantShortName),m=m.append("NodeId",t),m=m.append("NodeCategoryId",o),this.isAPiCallInProcess=!0,this.apiCall.login(u.h.urls.GetGalleryList,m).subscribe({next:p=>{this.isAPiCallInProcess=!1,this.isErrorInApiCall=!1,this.data=p,this.dataMain=p},error:p=>{this.isErrorInApiCall=!0,this.isAPiCallInProcess=!1}})})}openFile(t,n,i){this.presentLoading();let o=this.getMIMEtype(n),l=this.file.dataDirectory+i;this.fileTransfer.create().download(t,`${l}`).then(m=>{let p=m.toURL();const I={title:i};this.loading.dismiss(),this.platform.is("ios")?this.document.viewDocument(p,o,I):this.fileOpener.open(p,o)})}backToAllNode(){this.galleryNavs=[]}RemoveNode(t,n){this.storage.get("user").then(i=>{const o=JSON.parse(i);this.userId=o.UserId,this.tenantShortName=o.TenantShortName;let l=new g.Nl;l=l.append("UserId",o.UserId),l=l.append("tenantName",o.TenantShortName),l=l.append("NodeId",t),this.apiCall.login(u.h.urls.DeleteNode,l).subscribe({next:d=>{d?(this.commonService.presentToast(n?"File Removed Successfully!":"Folder Removed Successfully!",3e3,"success"),this.getGalleryData(this.currentNodeId,this.currentFolderName,null,this.nodeCategoryId)):this.commonService.presentToast("Folder Cannot Be Deleted Since It Has Child Items",3e3,"danger")},error:d=>{this.isErrorInApiCall=!0,this.isAPiCallInProcess=!1}})})}getMIMEtype(t){return{".txt":"text/plain",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".doc":"application/msword",".pdf":"application/pdf",".rtf":"application/rtf",".xls":"application/vnd.ms-excel",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".ppt":"application/vnd.ms-powerpoint",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".jpg":"image/jpeg",".jpeg":"image/jpeg",".jpe":"image/jpeg",".png":"image/png",".gif":"image/gif",".bmp":"image/bmp",".webp":"image/webp",".tif":"image/tiff",".tiff":"image/tiff",".svg":"image/svg+xml",".ico":"image/x-icon",".heic":"image/heic",".heif":"image/heif",".avif":"image/avif",".mp3":"audio/mpeg",".wav":"audio/wav",".ogg":"audio/ogg",".oga":"audio/ogg",".m4a":"audio/mp4",".aac":"audio/aac",".flac":"audio/flac",".amr":"audio/amr",".opus":"audio/opus",".mid":"audio/midi",".midi":"audio/midi",".aiff":"audio/aiff",".aif":"audio/aiff",".au":"audio/basic",".wma":"audio/x-ms-wma",".mp4":"video/mp4",".m4v":"video/x-m4v",".mov":"video/quicktime",".wmv":"video/x-ms-wmv",".avi":"video/x-msvideo",".flv":"video/x-flv",".webm":"video/webm",".mkv":"video/x-matroska",".3gp":"video/3gpp",".3g2":"video/3gpp2",".mpeg":"video/mpeg",".mpg":"video/mpeg",".ogv":"video/ogg",".ts":"video/mp2t",".mts":"video/MP2T",".m2ts":"video/MP2T"}[t.toLowerCase()]}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(k.OD),e.rXU(C.Z),e.rXU(M.A),e.rXU(G.M),e.rXU(x.C),e.rXU(j.h),e.rXU(v.Ix),e.rXU(b.w),e.rXU(F.J),e.rXU(r.Xi),e.rXU(f.ok),e.rXU(g.Qq),e.rXU(r.GD),e.rXU(r.W3),e.rXU(r.hG))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-dms"]],viewQuery:function(n,i){if(1&n&&e.GBs(R,5),2&n){let o;e.mGM(o=e.lsd())&&(i.userInputViewChild=o.first)}},standalone:!1,decls:11,vars:8,consts:[["userInput",""],[3,"title","isBackRequired"],[1,"common-ion-content"],[1,"il-img-size","il-image-positin","galleryImage",3,"src"],["showCancelButton","never",3,"placeholder","keyup",4,"ngIf"],[4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed",4,"ngIf"],["type","file","accept","image/png, image/jpeg",1,"fileInput",2,"position","absolute","width","0","height","0","opacity","0",3,"change"],["showCancelButton","never",3,"keyup","placeholder"],[4,"ngFor","ngForOf"],["size","12"],["animated","",2,"width","100%"],[2,"border-top","1px solid #ffffff"],["size","4","offset","4"],["button","",1,"d-content"],["slot","start"],["onerror","this.src='https://excelsis360.com/Content/dist/img/file-formats/file.png';",2,"border-radius","inherit!important",3,"click","src"],[1,"cls-fileName",3,"click"],["vertical","bottom","horizontal","end","slot","fixed"],[3,"click"],["name","cloud-upload-outline"],["color","danger",3,"click",4,"ngIf"],["class","somthingWrong",4,"ngIf"],["color","danger",3,"click"],["slot","start","size","small","name","chevron-back-outline"],["button","","class","d-content",4,"ngIf"],["class","d-content",4,"ngIf"],["slot","start",3,"click"],["onerror","this.src='https://excelsis360.com/Content/dist/img/file-formats/file.png';",3,"src"],["size","small","color","primary","name","create",3,"click",4,"ngIf"],["size","small","color","success","name","key-sharp",3,"click",4,"ngIf"],["slot","end","size","small","color","danger","name","trash",3,"click",4,"ngIf"],["size","small","color","primary","name","create",3,"click"],["size","small","color","success","name","key-sharp",3,"click"],["slot","end","size","small","color","danger","name","trash",3,"click"],[1,"d-content"],[3,"src"],[1,"somthingWrong"]],template:function(n,i){if(1&n){const o=e.RV6();e.nrm(0,"app-header-toolbar",1),e.j41(1,"ion-content",2),e.nrm(2,"ion-img",3),e.DNE(3,A,1,2,"ion-searchbar",4)(4,B,3,2,"div",5)(5,V,2,1,"div",5)(6,E,3,0,"ion-fab",6)(7,q,5,4,"div",5),e.j41(8,"ion-item")(9,"input",7,0),e.bIt("change",function(d){return e.eBV(o),e.Njj(i.loadImageFromDevice(d))}),e.k0s()()()}2&n&&(e.Y8G("title",i.heading)("isBackRequired",i.isBackRequired),e.R7$(2),e.Y8G("src",i.galleryImage),e.R7$(),e.Y8G("ngIf",!i.isAPiCallInProcess&&i.galleryNavs&&i.galleryNavs.length>0),e.R7$(),e.Y8G("ngIf",i.isAPiCallInProcess),e.R7$(),e.Y8G("ngIf",!i.isAPiCallInProcess&&i.allNodes&&0==i.galleryNavs.length),e.R7$(),e.Y8G("ngIf",!i.isAPiCallInProcess&&i.data&&i.galleryNavs.length>0&&!i.hasStudentRole),e.R7$(),e.Y8G("ngIf",!i.isAPiCallInProcess&&i.data&&i.galleryNavs.length>0))},dependencies:[h.Sq,h.bT,r.mC,r.Jm,r.b_,r.hU,r.W9,r.Q8,r.YW,r.iq,r.KW,r.uz,r.he,r.nf,r.ln,r.S1,r.ds,r.Gw,T.M],styles:[".d-content[_ngcontent-%COMP%]{display:contents}.cls-fileName[_ngcontent-%COMP%]{margin:25px}.galleryImage[_ngcontent-%COMP%]{margin-bottom:10px}#file-input[_ngcontent-%COMP%]{opacity:0;position:absolute;top:0;width:100%;height:100%;left:0;z-index:999;background-color:none}"]})}}return s})()}];let te=(()=>{class s{static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275mod=e.$C({type:s})}static{this.\u0275inj=e.G2t({imports:[v.iI.forChild(ee),v.iI]})}}return s})();var ie=a(5075);let ne=(()=>{class s{static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275mod=e.$C({type:s})}static{this.\u0275inj=e.G2t({imports:[h.MD,f.YN,f.X1,r.bv,te,ie.HomePageModule]})}}return s})()}}]);