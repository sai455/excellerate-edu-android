"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5496],{5496:(U,m,l)=>{l.r(m),l.d(m,{StaffAttendanceEntryPageModule:()=>B});var d=l(177),h=l(4341),o=l(3465),u=l(9522),S=l(467),f=l(1626),p=l(1840),t=l(4438),I=l(3656),C=l(2571),P=l(369),y=l(6886),_=l(2490),A=l(5493);function v(i,c){if(1&i&&(t.j41(0,"ion-select-option",19),t.EFF(1),t.k0s()),2&i){const e=c.$implicit;t.Y8G("value",e.GroupId),t.R7$(),t.JRh(e.GroupName)}}function E(i,c){if(1&i&&(t.j41(0,"div",20),t.EFF(1),t.k0s()),2&i){const e=c.value,s=t.XpG(2);t.R7$(),t.SpI(" ",s.formatGroups(e)," ")}}function j(i,c){if(1&i){const e=t.RV6();t.j41(0,"ion-datetime",21),t.mxI("ngModelChange",function(n){t.eBV(e);const a=t.XpG(2);return t.DH7(a.attendanceDate,n)||(a.attendanceDate=n),t.Njj(n)}),t.k0s()}if(2&i){const e=t.XpG(2);t.Y8G("showDefaultButtons",!0),t.R50("ngModel",e.attendanceDate)}}function F(i,c){if(1&i){const e=t.RV6();t.j41(0,"ion-card",3)(1,"ion-card-header",4)(2,"ion-card-title"),t.EFF(3),t.k0s()(),t.j41(4,"ion-card-content")(5,"ion-list")(6,"ion-item")(7,"ion-label",5),t.EFF(8,"Staff Id "),t.k0s(),t.j41(9,"ion-input",6),t.mxI("ngModelChange",function(n){t.eBV(e);const a=t.XpG();return t.DH7(a.staffId,n)||(a.staffId=n),t.Njj(n)}),t.k0s()(),t.j41(10,"ion-item")(11,"ion-label",5),t.EFF(12,"Staff Name "),t.k0s(),t.j41(13,"ion-input",6),t.mxI("ngModelChange",function(n){t.eBV(e);const a=t.XpG();return t.DH7(a.staffName,n)||(a.staffName=n),t.Njj(n)}),t.k0s()(),t.j41(14,"ion-item")(15,"ion-label"),t.EFF(16,"Role"),t.j41(17,"ion-text",7),t.EFF(18,"*"),t.k0s()(),t.j41(19,"ion-select",8),t.mxI("ngModelChange",function(n){t.eBV(e);const a=t.XpG();return t.DH7(a.roleSelected,n)||(a.roleSelected=n),t.Njj(n)}),t.DNE(20,v,2,2,"ion-select-option",9),t.k0s()(),t.j41(21,"ion-item")(22,"ion-label"),t.EFF(23,"Groups "),t.k0s(),t.j41(24,"ionic-selectable",10),t.mxI("ngModelChange",function(n){t.eBV(e);const a=t.XpG();return t.DH7(a.groupsSelected,n)||(a.groupsSelected=n),t.Njj(n)}),t.bIt("onChange",function(n){t.eBV(e);const a=t.XpG();return t.Njj(a.groupSelectionChange(n))}),t.DNE(25,E,2,1,"ng-template",11),t.k0s()(),t.j41(26,"ion-item")(27,"ion-label",12),t.EFF(28,"Date"),t.j41(29,"ion-text",7),t.EFF(30,"*"),t.k0s()(),t.nrm(31,"ion-input",13),t.nI1(32,"date"),t.j41(33,"ion-popover",14),t.DNE(34,j,1,2,"ng-template"),t.k0s()(),t.j41(35,"ion-row",15)(36,"ion-col",16)(37,"ion-button",17),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.onSearch())}),t.nrm(38,"ion-icon",18),t.EFF(39," Search "),t.k0s()()()()()()}if(2&i){const e=t.XpG();t.R7$(3),t.SpI(" Staff Attendance Entrance ",e.showStudents," "),t.R7$(6),t.R50("ngModel",e.staffId),t.Y8G("disabled",e.isAPiCallInProcess),t.R7$(4),t.R50("ngModel",e.staffName),t.Y8G("disabled",e.isAPiCallInProcess),t.R7$(6),t.R50("ngModel",e.roleSelected),t.R7$(),t.Y8G("ngForOf",e.roles),t.R7$(4),t.R50("ngModel",e.groupsSelected),t.Y8G("items",e.groupList)("canSearch",!0)("isMultiple",!0),t.R7$(7),t.FS9("value",t.i5U(32,13,e.attendanceDate,"dd MMM yyyy")),t.R7$(6),t.FS9("disabled",e.roleSelected&&""==e.roleSelected)}}function G(i,c){1&i&&(t.j41(0,"ion-text",7)(1,"h4"),t.EFF(2,"No Records Found"),t.k0s()())}function N(i,c){1&i&&(t.j41(0,"ion-text",32)(1,"h4")(2,"em"),t.EFF(3,"Loading User Details..."),t.k0s()()())}function x(i,c){if(1&i&&t.nrm(0,"img",37),2&i){const e=t.XpG().$implicit;t.Mz_("src","https://excelsis360.com/Content/UserProfile/",e.UserPhoto,"",t.B4B)}}function R(i,c){1&i&&t.nrm(0,"img",38)}function b(i,c){if(1&i){const e=t.RV6();t.j41(0,"ion-item")(1,"ion-avatar",12),t.DNE(2,x,1,2,"img",34)(3,R,1,0,"img",35),t.k0s(),t.j41(4,"ion-label")(5,"h2"),t.EFF(6),t.k0s(),t.j41(7,"h3"),t.EFF(8),t.k0s()(),t.j41(9,"ion-toggle",36),t.bIt("ionChange",function(n){const a=t.eBV(e).$implicit,r=t.XpG(3);return t.Njj(r.onToggle(n,a))}),t.k0s()()}if(2&i){const e=c.$implicit;t.R7$(2),t.Y8G("ngIf",null!=e.UserPhoto),t.R7$(),t.Y8G("ngIf",null==e.UserPhoto),t.R7$(3),t.JRh(e.Name),t.R7$(2),t.JRh(e.ID),t.R7$(),t.FS9("checked",e.PresentFlag)}}function M(i,c){if(1&i&&(t.j41(0,"ion-list"),t.DNE(1,b,10,5,"ion-item",33),t.k0s()),2&i){const e=t.XpG(2);t.R7$(),t.Y8G("ngForOf",e.studentsList)}}function T(i,c){if(1&i){const e=t.RV6();t.j41(0,"div")(1,"ion-row",22)(2,"ion-col",23)(3,"ion-button",24),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.backToSearch())}),t.nrm(4,"ion-icon",25),t.EFF(5," Back To Search "),t.k0s()(),t.j41(6,"ion-col",26)(7,"ion-button",27),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.saveAttendance())}),t.nrm(8,"ion-icon",28),t.EFF(9," Save Attendance "),t.k0s()()(),t.j41(10,"ion-toolbar")(11,"ion-searchbar",29),t.bIt("keyup",function(n){t.eBV(e);const a=t.XpG();return t.Njj(a.onStudentSearchKeyUp(n))}),t.k0s()(),t.DNE(12,G,3,0,"ion-text",30)(13,N,4,0,"ion-text",31)(14,M,2,1,"ion-list",2),t.k0s()}if(2&i){const e=t.XpG();t.R7$(7),t.FS9("disabled",0==e.studentsChanged.length),t.R7$(5),t.Y8G("ngIf",e.studentsList&&0==e.studentsList.length),t.R7$(),t.Y8G("ngIf",e.isAPiCallInProcess),t.R7$(),t.Y8G("ngIf",e.studentsList&&e.studentsList.length>0)}}const D=[{path:"",component:(()=>{class i{constructor(e,s,n,a,r,g,X){this.platform=e,this.commonService=s,this.router=n,this.storage=a,this.apiCall=r,this.datePipe=g,this.loadingController=X,this.heading="Staff Attendance",this.isBackRequired=!0,this.attendanceDate=(new Date).toISOString(),this.studentsChanged=[]}ngOnInit(){this.meetingData=this.commonService.getSelectedMeeting(),this.getGroupsList(),this.getRoles()}getRoles(){this.storage.get("user").then(e=>{const s=JSON.parse(e);let n=new f.Nl;n=n.append("tenantName",s.TenantShortName),this.isAPiCallInProcess=!0,this.apiCall.login(p.h.urls.GetStaffAttendanceRoles,n).subscribe(a=>{this.roles=a,this.isAPiCallInProcess=!1,this.isErrorInApiCall=!1},a=>{this.isErrorInApiCall=!0,this.isAPiCallInProcess=!1})})}getGroupsList(){this.storage.get("user").then(e=>{const s=JSON.parse(e);let n=new f.Nl;n=n.append("UserID",s.UserId),n=n.append("tenantName",s.TenantShortName),this.isAPiCallInProcess=!0,this.apiCall.login(p.h.urls.getGropusList,n).subscribe(a=>{this.groupList=a.GroupList,this.isAPiCallInProcess=!1,this.isErrorInApiCall=!1},a=>{this.isErrorInApiCall=!0,this.isAPiCallInProcess=!1})})}formatGroups(e){return e.map(s=>s.GroupName).join(", ")}onSearch(){var e=(this.groupsSelected??[]).map(s=>s.GroupId).join(",");this.getStudents(e=""==e?"0":e,this.attendanceDate),this.showStudents=!0}backToSearch(){this.showStudents=!1,this.studentsList=null}groupSelectionChange(e){}getStudents(e,s){this.storage.get("user").then(n=>{const a=JSON.parse(n);let r=new f.Nl;r=r.append("tenantName",a.TenantShortName),r=r.append("userId",a.UserId),r=r.append("staffName",this.staffName??""),r=r.append("staffId",this.staffId??""),r=r.append("roleId",this.roleSelected),r=r.append("groupId",e),r=r.append("AttendanceDate",this.datePipe.transform(this.attendanceDate,"yyyy/MM/dd")||""),this.isAPiCallInProcess=!0,this.apiCall.login(p.h.urls.GetStaffAttendance,r).subscribe(g=>{this.isAPiCallInProcess=!1,this.studentsList=g,this.studentsListMain=g},g=>{this.isErrorInApiCall=!0,this.isAPiCallInProcess=!1})})}onStudentSearchKeyUp(e){let s=e.target.value;this.studentsList=0==s.length?this.studentsListMain:this.studentsListMain.filter(n=>n.Name.toLocaleLowerCase().includes(s.toLocaleLowerCase())||(n.ID??"").toString().includes(s)||(n.LegacyStudentID??"").toLocaleLowerCase().toString().includes(s))}onToggle(e,s){s.PresentFlag=!s.PresentFlag;var n=this.studentsChanged.filter(a=>a.ID==s.ID);n&&n.length>0?this.studentsChanged.forEach(function(a){a.ID==s.ID&&(a.PresentFlag=s.PresentFlag)}):this.studentsChanged.push(s)}presentLoading(){var e=this;return(0,S.A)(function*(){e.loading=yield e.loadingController.create({message:"Saving Attendance request details.."}),yield e.loading.present()})()}saveAttendance(){var e=(this.groupsSelected??[]).map(s=>s.GroupId).join(",");e=""==e?"0":e,this.presentLoading(),this.storage.get("user").then(s=>{const n=JSON.parse(s);let a=new f.Nl;a=a.append("LoggedInUserID",n.UserId),a=a.append("tenantName",n.TenantShortName),a=a.append("roleId",this.roleSelected),a=a.append("groupId",e),a=a.append("AttendanceDate",this.datePipe.transform(this.attendanceDate,"MM/dd/yyyy")||""),a=a.append("AttendanceStr",JSON.stringify(this.studentsChanged)),this.apiCall.login(p.h.urls.SaveStaffAttendance,a).subscribe(r=>{this.isAPiCallInProcess=!1,this.studentsList=r,this.commonService.presentToast("Attendance details saved successfully",3e3),this.loading.dismiss(),this.backToSearch()},r=>{this.loading.dismiss(),this.commonService.presentToast("Internal problem, please try again",3e3,"danger")})})}static{this.\u0275fac=function(s){return new(s||i)(t.rXU(I.OD),t.rXU(C.h),t.rXU(u.Ix),t.rXU(P.w),t.rXU(y.J),t.rXU(d.vh),t.rXU(o.Xi))}}static{this.\u0275cmp=t.VBU({type:i,selectors:[["app-staff-attendance-entry"]],standalone:!1,features:[t.Jv_([d.vh])],decls:4,vars:4,consts:[[3,"title","isBackRequired"],["color","primary","no-padding","","class","service-head",4,"ngIf"],[4,"ngIf"],["color","primary","no-padding","",1,"service-head"],[2,"border-bottom","1px solid white","margin-bottom","10px"],["position","floating",1,"vo-form-label"],["type","text",3,"ngModelChange","ngModel","disabled"],["color","danger"],["placeholder","Select Role",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["item-content","","itemValueField","GroupId","itemTextField","GroupName",3,"ngModelChange","onChange","ngModel","items","canSearch","isMultiple"],["ionicSelectableValueTemplate",""],["slot","start"],["slot","end","id","attendanceDate",3,"value"],["trigger","attendanceDate"],[1,"ion-text-center",2,"border-top","1px solid #ffffff"],["size","12"],["color","primary",3,"click","disabled"],["slot","start","name","search"],[3,"value"],[1,"ionic-selectable-value-item"],["presentation","date","min","2025-01-01T00:00:00","max","2035-12-31T23:59:59","cancelText","Cancel","doneText","OK",3,"ngModelChange","showDefaultButtons","ngModel"],[2,"border-top","1px solid #ffffff"],["size","6"],["color","danger","size","small",3,"click"],["slot","start","name","chevron-back-outline"],["size","4"],["color","primary","size","small",3,"click","disabled"],["slot","start","name","save-outline"],["placeholder","Search By Name","showCancelButton","never",3,"keyup"],["color","danger",4,"ngIf"],["color","primary","class","ion-text-center",4,"ngIf"],["color","primary",1,"ion-text-center"],[4,"ngFor","ngForOf"],[3,"src",4,"ngIf"],["src","https://excelsis360.com/Content/dist/img/default-user.jpg",4,"ngIf"],["slot","end",3,"ionChange","checked"],[3,"src"],["src","https://excelsis360.com/Content/dist/img/default-user.jpg"]],template:function(s,n){1&s&&(t.nrm(0,"app-header-toolbar",0),t.j41(1,"ion-content"),t.DNE(2,F,40,16,"ion-card",1)(3,T,15,4,"div",2),t.k0s()),2&s&&(t.Y8G("title",n.heading)("isBackRequired",n.isBackRequired),t.R7$(2),t.Y8G("ngIf",!n.showStudents),t.R7$(),t.Y8G("ngIf",n.showStudents))},dependencies:[d.Sq,d.bT,h.BC,h.vS,o.mC,o.Jm,o.b_,o.I9,o.ME,o.tN,o.hU,o.W9,o.A9,o.iq,o.$w,o.uz,o.he,o.nf,o.ln,o.S1,o.Nm,o.Ip,o.IO,o.BY,o.ai,o.CF,o.hB,o.Je,o.Gw,_.e,A.M,d.vh],encapsulation:2})}}return i})()}];let k=(()=>{class i{static{this.\u0275fac=function(s){return new(s||i)}}static{this.\u0275mod=t.$C({type:i})}static{this.\u0275inj=t.G2t({imports:[u.iI.forChild(D),u.iI]})}}return i})();var L=l(5075);let B=(()=>{class i{static{this.\u0275fac=function(s){return new(s||i)}}static{this.\u0275mod=t.$C({type:i})}static{this.\u0275inj=t.G2t({imports:[d.MD,h.YN,o.bv,k,_.e,L.HomePageModule]})}}return i})()}}]);