"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4948],{4948:(re,P,s)=>{s.r(P),s.d(P,{GalleryPageModule:()=>ne});var y=s(177),v=s(4341),c=s(3465),I=s(9522),g=s(467),C=s(3125),N=s(1626),G=s(1840),x=s(2163),F=s(5121),j=s(3319),e=s(4438),b=s(3656),R=s(252),D=s(3144),T=s(9684),S=s(3644),w=s(2571),X=s(369),M=s(6886),U=s(5493);const $=["userInput"],A=()=>[0,1,2,3,4,5,6,7,8,9,10];function B(l,d){if(1&l){const i=e.RV6();e.j41(0,"ion-searchbar",12),e.bIt("keyup",function(t){e.eBV(i);const o=e.XpG();return e.Njj(o.onGallerySearchKeyUp(t))}),e.k0s()}if(2&l){const i=e.XpG();e.Y8G("placeholder",i.galleryNavs[i.galleryNavs.length-1].FolderName)}}function E(l,d){if(1&l){const i=e.RV6();e.j41(0,"ion-searchbar",13),e.bIt("keyup",function(t){e.eBV(i);const o=e.XpG();return e.Njj(o.onGallerySearchKeyUp(t))}),e.k0s()}}function V(l,d){1&l&&(e.j41(0,"ion-card")(1,"ion-row")(2,"ion-col",14),e.nrm(3,"ion-skeleton-text",15),e.k0s()(),e.j41(4,"ion-row")(5,"ion-col",14),e.nrm(6,"ion-skeleton-text",15),e.k0s()(),e.j41(7,"ion-row")(8,"ion-col",14),e.nrm(9,"ion-skeleton-text",15),e.k0s()(),e.j41(10,"ion-row")(11,"ion-col",14),e.nrm(12,"ion-skeleton-text",15),e.k0s()(),e.j41(13,"ion-row")(14,"ion-col",14),e.nrm(15,"ion-skeleton-text",15),e.k0s()(),e.j41(16,"ion-row",16)(17,"ion-col",17),e.nrm(18,"ion-skeleton-text",15),e.k0s()()())}function Y(l,d){1&l&&(e.j41(0,"div")(1,"ion-list"),e.DNE(2,V,19,0,"ion-card",9),e.k0s()()),2&l&&(e.R7$(2),e.Y8G("ngForOf",e.lJ4(1,A)))}function O(l,d){if(1&l){const i=e.RV6();e.j41(0,"ion-fab",18)(1,"ion-fab-button",19),e.bIt("click",function(){e.eBV(i);const t=e.XpG();return e.Njj(t.presentActionSheet())}),e.nrm(2,"ion-icon",20),e.k0s()()}}function z(l,d){if(1&l){const i=e.RV6();e.j41(0,"ion-button",21),e.bIt("click",function(){e.eBV(i);const t=e.XpG();return e.Njj(t.getGalleryData(t.galleryNavs[t.galleryNavs.length-2].NodeId,t.galleryNavs[t.galleryNavs.length-2].FolderName,!0))}),e.nrm(1,"ion-icon",22),e.EFF(2),e.k0s()}if(2&l){const i=e.XpG();e.R7$(2),e.SpI(" ",i.galleryNavs[i.galleryNavs.length-1].FolderName," ")}}function L(l,d){if(1&l){const i=e.RV6();e.j41(0,"ion-icon",32),e.bIt("click",function(){e.eBV(i);const t=e.XpG(2).$implicit,o=e.XpG();return e.Njj(o.openEditFileNamePopup(t.NodeId,t.NodeName))}),e.k0s()}}function W(l,d){if(1&l){const i=e.RV6();e.j41(0,"ion-icon",33),e.bIt("click",function(){e.eBV(i);const t=e.XpG(2).$implicit,o=e.XpG();return e.Njj(o.openSearchModal(t.NodeId,t.NodeName,!0))}),e.k0s()}}function J(l,d){if(1&l){const i=e.RV6();e.j41(0,"ion-icon",34),e.bIt("click",function(){e.eBV(i);const t=e.XpG(2).$implicit,o=e.XpG();return e.Njj(o.presentAlertConfirm(t.NodeId,!0))}),e.k0s()}}function K(l,d){if(1&l){const i=e.RV6();e.j41(0,"ion-item",25)(1,"ion-avatar",26),e.bIt("click",function(){e.eBV(i);const t=e.XpG().$implicit,o=e.XpG();return e.Njj(o.openFile(t.FileUrl,t.Ext,t.FileName))}),e.nrm(2,"img",27),e.k0s(),e.j41(3,"ion-label",28),e.bIt("click",function(){e.eBV(i);const t=e.XpG().$implicit,o=e.XpG();return e.Njj(o.openFile(t.FileUrl,t.Ext,t.FileName))}),e.EFF(4),e.k0s(),e.DNE(5,L,1,0,"ion-icon",29)(6,W,1,0,"ion-icon",30)(7,J,1,0,"ion-icon",31),e.k0s()}if(2&l){const i=e.XpG().$implicit;e.R7$(2),e.Y8G("src",i.FileUrl,e.B4B),e.R7$(2),e.SpI(" ",i.NodeName," "),e.R7$(),e.Y8G("ngIf",i.Modify),e.R7$(),e.Y8G("ngIf",i.Modify),e.R7$(),e.Y8G("ngIf",i.Modify)}}function Q(l,d){if(1&l){const i=e.RV6();e.j41(0,"ion-icon",33),e.bIt("click",function(){e.eBV(i);const t=e.XpG(2).$implicit,o=e.XpG();return e.Njj(o.openSearchModal(t.NodeId,t.NodeName,!1))}),e.k0s()}}function H(l,d){if(1&l){const i=e.RV6();e.j41(0,"ion-icon",34),e.bIt("click",function(){e.eBV(i);const t=e.XpG(2).$implicit,o=e.XpG();return e.Njj(o.presentAlertConfirm(t.NodeId,!0))}),e.k0s()}}function Z(l,d){if(1&l){const i=e.RV6();e.j41(0,"ion-item",35)(1,"ion-avatar",26),e.bIt("click",function(){e.eBV(i);const t=e.XpG().$implicit,o=e.XpG();return e.Njj(o.getGalleryData(t.NodeId,t.NodeName,null))}),e.nrm(2,"img",36),e.k0s(),e.j41(3,"ion-label",28),e.bIt("click",function(){e.eBV(i);const t=e.XpG().$implicit,o=e.XpG();return e.Njj(o.getGalleryData(t.NodeId,t.NodeName,!1))}),e.EFF(4),e.k0s(),e.DNE(5,Q,1,0,"ion-icon",30)(6,H,1,0,"ion-icon",31),e.k0s()}if(2&l){const i=e.XpG().$implicit,n=e.XpG();e.R7$(2),e.Y8G("src",n.folderImage,e.B4B),e.R7$(2),e.SpI(" ",i.NodeName," "),e.R7$(),e.Y8G("ngIf",i.Modify),e.R7$(),e.Y8G("ngIf",i.Modify)}}function q(l,d){if(1&l&&(e.j41(0,"ion-list"),e.DNE(1,K,8,5,"ion-item",23)(2,Z,7,4,"ion-item",24),e.k0s()),2&l){const i=d.$implicit;e.R7$(),e.Y8G("ngIf",i.FileName.length>0),e.R7$(),e.Y8G("ngIf",0==i.FileName.length)}}function ee(l,d){1&l&&(e.j41(0,"div",37),e.EFF(1,"No files found."),e.k0s())}const te=[{path:"",component:(()=>{class l{ngAfterViewInit(){this.userInputElement=this.userInputViewChild.nativeElement}constructor(i,n,t,o,a,r,p,f,h,m,k,u,_,le,ae){this.platform=i,this.file=n,this.fileTransfer=t,this.fileOpener=o,this.document=a,this.commonService=r,this.router=p,this.storage=f,this.apiCall=h,this.loadingController=m,this.formBuilder=k,this.httpClient=u,this.actionSheetController=_,this.modalController=le,this.alertController=ae,this.galleryImage=C.l.appImages.gallery,this.folderImage=C.l.appImages.folder,this.heading="Gallery",this.isBackRequired=!0,this.data=[],this.dataMain=[],this.isAPiCallInProcess=!1,this.isErrorInApiCall=!1,this.galleryNavs=[],this.hasStudentRole=!0}ngOnInit(){this.getGalleryData(4,"Root",!1),this.uploadForm=this.formBuilder.group({profile:[""]})}presentActionSheet(){var i=this;return(0,g.A)(function*(){let n=document.createElement("input");n.setAttribute("type","file"),n.setAttribute("style","position: relative; z-index: 99999; width: 100%; height: 100%; opacity: 0"),n.addEventListener("change",a=>{i.loadImageFromDevice(a)});const t=yield i.actionSheetController.create({header:"Add New Folder / File",backdropDismiss:!1,animated:!0,cssClass:"my-custom-class",buttons:[{text:"Document",icon:"document",role:"destructive",handler:()=>{i.userInputElement.click()}},{text:"Folder",role:"destructive",icon:"folder-open",handler:()=>{i.openModal()}},{text:"Cancel",icon:"close",role:"cancel",handler:()=>{}}]});yield t.present(),yield t.onDidDismiss()})()}presentAlertConfirm(i,n){var t=this;return(0,g.A)(function*(){yield(yield t.alertController.create({cssClass:"my-custom-class",header:"Confirm!",backdropDismiss:!1,message:"<strong>Are you sure you wish to delete ?</strong>",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:a=>{}},{text:"Okay",handler:()=>{t.RemoveNode(i,n)}}]})).present()})()}loadImageFromDevice(i){const n=i.target.files[0],t=new FileReader;t.readAsArrayBuffer(n);const o=new FormData;o.append("file",n),this.httpClient.post(G.h.urls.AddUserDMSFile+"/"+this.currentNodeId+"/"+this.userId+"/"+this.tenantShortName+"/4",o).subscribe({next:r=>{this.commonService.presentToast("File Uploaded Successfully.",3e3,"success"),this.getGalleryData(this.currentNodeId,this.currentFolderName,null)},error:r=>this.commonService.presentToast("An error occurred while processing, please try sometime later.",3e3,"danger")}),t.onerror=r=>{}}presentLoading(){var i=this;return(0,g.A)(function*(){i.loading=yield i.loadingController.create({message:"Opening the document.."}),yield i.loading.present()})()}openFileNameModal(i,n){var t=this;return(0,g.A)(function*(){const o=yield t.modalController.create({component:j.l,showBackdrop:!0,backdropDismiss:!1,cssClass:"my-custom-modal-css",componentProps:{modalTitle:"Update File Name",tenantShortName:t.tenantShortName,nodeId:i,nodeName:n}});return o.onDidDismiss().then(a=>{null!==a.data&&t.getGalleryData(t.currentNodeId,t.currentFolderName,null)}),yield o.present()})()}openModal(){var i=this;return(0,g.A)(function*(){const n=yield i.modalController.create({component:x.D,showBackdrop:!0,backdropDismiss:!1,cssClass:"my-custom-modal-css",componentProps:{modalTitle:"New Folder",userId:i.userId,tenantShortName:i.tenantShortName,nodeId:i.currentNodeId,nodeCategoryId:"4"}});return n.onDidDismiss().then(t=>{null!==t.data&&i.getGalleryData(i.currentNodeId,i.currentFolderName,null)}),yield n.present()})()}openSearchModal(i,n,t){var o=this;return(0,g.A)(function*(){const a=yield o.modalController.create({component:F.r,showBackdrop:!0,backdropDismiss:!1,cssClass:"my-search-modal-css",componentProps:{modalTitle:"Permissions For "+n,userId:o.userId,tenantShortName:o.tenantShortName,nodeId:i,nodeCategoryId:"4"}});return a.onDidDismiss().then(r=>{null!==r.data&&o.getGalleryData(o.currentNodeId,o.currentFolderName,null)}),yield a.present()})()}openEditFileNamePopup(i,n){this.openFileNameModal(i,n)}onGallerySearchKeyUp(i){let n=i.target.value;this.data=0==n.length?this.dataMain:this.dataMain.filter(t=>t.NodeName.toLocaleLowerCase().includes(n.toLocaleLowerCase()))}getGalleryData(i,n,t){this.currentNodeId=i,this.currentFolderName=n,null!=t&&(t?this.galleryNavs.pop():this.galleryNavs.push({NodeId:i,FolderName:n})),this.storage.get("user").then(o=>{const a=JSON.parse(o);this.userId=a.UserId,a.Roles&&(this.hasStudentRole=!!a.Roles.includes("Student")),this.tenantShortName=a.TenantShortName;let r=new N.Nl;r=r.append("UserID",a.UserId),r=r.append("tenantName",a.TenantShortName),r=r.append("NodeId",i),r=r.append("NodeCategoryId","4"),this.isAPiCallInProcess=!0,this.apiCall.login(G.h.urls.GetGalleryList,r).subscribe({next:p=>{this.isAPiCallInProcess=!1,this.isErrorInApiCall=!1,this.data=p,this.dataMain=p},error:p=>{this.isErrorInApiCall=!0,this.isAPiCallInProcess=!1}})})}openFile(i,n,t){var o=this;return(0,g.A)(function*(){try{yield o.presentLoading();const a=o.getMIMEtype(n);if(!a)throw new Error(`Unsupported file type: ${n}`);const r=o.fileTransfer.create(),p="temp",f=o.platform.is("android")?o.file.externalDataDirectory:o.file.dataDirectory,h=`${f}${p}/${t}`;try{yield o.file.createDir(f,p,!0).catch(()=>console.log("Temp directory already exists")),console.log("Downloading file from:",i),console.log("Saving to:",h);const m=yield r.download(encodeURI(i),h,!0,{headers:{"Access-Control-Allow-Origin":"*"}});console.log("Download complete. File location:",m.toURL());const k=yield o.file.checkFile(f+p+"/",t);if(console.log("File exists after download:",k),yield o.loading.dismiss(),o.platform.is("ios")){const u={title:t};yield o.document.viewDocument(m.toURL(),a,u)}else{const u=m.nativeURL||m.toURL();console.log("Attempting to open file at:",u),yield o.fileOpener.open(u,a).catch(_=>{throw console.error("FileOpener error:",_),new Error(`Cannot open file: ${_.message}`)})}}catch(m){throw console.error("File operation error:",m),yield o.loading.dismiss(),m instanceof Error?new Error(`File operation failed: ${m.message}`):new Error("File operation failed: Unknown error")}}catch(a){yield o.loading.dismiss();const r=a instanceof Error?a.message:"Unknown error occurred";console.error("Error in openFile:",r),o.commonService.presentToast(r,3e3,"danger")}})()}RemoveNode(i,n){this.storage.get("user").then(t=>{const o=JSON.parse(t);this.userId=o.UserId,this.tenantShortName=o.TenantShortName;let a=new N.Nl;a=a.append("UserId",o.UserId),a=a.append("tenantName",o.TenantShortName),a=a.append("NodeId",i),this.apiCall.login(G.h.urls.DeleteNode,a).subscribe({next:r=>{r?(this.commonService.presentToast(n?"File Removed Successfully!":"Folder Removed Successfully!",3e3,"success"),this.getGalleryData(this.currentNodeId,this.currentFolderName,null)):this.commonService.presentToast("Folder Cannot Be Deleted Since It Has Child Items",3e3,"danger")},error:r=>{this.isErrorInApiCall=!0,this.isAPiCallInProcess=!1}})})}getMIMEtype(i){return{".txt":"text/plain",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".doc":"application/msword",".pdf":"application/pdf",".rtf":"application/rtf",".xls":"application/vnd.ms-excel",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".ppt":"application/vnd.ms-powerpoint",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".jpg":"image/jpeg",".jpeg":"image/jpeg",".jpe":"image/jpeg",".png":"image/png",".gif":"image/gif",".bmp":"image/bmp",".webp":"image/webp",".tif":"image/tiff",".tiff":"image/tiff",".svg":"image/svg+xml",".ico":"image/x-icon",".heic":"image/heic",".heif":"image/heif",".avif":"image/avif",".mp3":"audio/mpeg",".wav":"audio/wav",".ogg":"audio/ogg",".oga":"audio/ogg",".m4a":"audio/mp4",".aac":"audio/aac",".flac":"audio/flac",".amr":"audio/amr",".opus":"audio/opus",".mid":"audio/midi",".midi":"audio/midi",".aiff":"audio/aiff",".aif":"audio/aiff",".au":"audio/basic",".wma":"audio/x-ms-wma",".mp4":"video/mp4",".m4v":"video/x-m4v",".mov":"video/quicktime",".wmv":"video/x-ms-wmv",".avi":"video/x-msvideo",".flv":"video/x-flv",".webm":"video/webm",".mkv":"video/x-matroska",".3gp":"video/3gpp",".3g2":"video/3gpp2",".mpeg":"video/mpeg",".mpg":"video/mpeg",".ogv":"video/ogg",".ts":"video/mp2t",".mts":"video/MP2T",".m2ts":"video/MP2T"}[i.toLowerCase()]}static{this.\u0275fac=function(n){return new(n||l)(e.rXU(b.OD),e.rXU(R.Z),e.rXU(D.A),e.rXU(T.M),e.rXU(S.C),e.rXU(w.h),e.rXU(I.Ix),e.rXU(X.w),e.rXU(M.J),e.rXU(c.Xi),e.rXU(v.ok),e.rXU(N.Qq),e.rXU(c.GD),e.rXU(c.W3),e.rXU(c.hG))}}static{this.\u0275cmp=e.VBU({type:l,selectors:[["app-gallery"]],viewQuery:function(n,t){if(1&n&&e.GBs($,5),2&n){let o;e.mGM(o=e.lsd())&&(t.userInputViewChild=o.first)}},standalone:!1,decls:13,vars:10,consts:[["userInput",""],[3,"title","isBackRequired"],[1,"common-ion-content"],[1,"il-img-size","il-image-positin","galleryImage",3,"src"],["showCancelButton","never",3,"placeholder","keyup",4,"ngIf"],["showCancelButton","never","placeholder","Search Gallery",3,"keyup",4,"ngIf"],[4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed",4,"ngIf"],["color","danger",3,"click",4,"ngIf"],[4,"ngFor","ngForOf"],["class","somthingWrong",4,"ngIf"],["type","file","accept","image/png, image/jpeg",1,"fileInput",2,"position","absolute","width","0","height","0","opacity","0",3,"change"],["showCancelButton","never",3,"keyup","placeholder"],["showCancelButton","never","placeholder","Search Gallery",3,"keyup"],["size","12"],["animated","",2,"width","100%"],[2,"border-top","1px solid #ffffff"],["size","4","offset","4"],["vertical","bottom","horizontal","end","slot","fixed"],[3,"click"],["name","cloud-upload-outline"],["color","danger",3,"click"],["slot","start","size","small","name","chevron-back-outline"],["button","","class","d-content",4,"ngIf"],["class","d-content",4,"ngIf"],["button","",1,"d-content"],["slot","start",3,"click"],["onerror","this.src='https://excelsis360.com/Content/dist/img/file-formats/file.png';",3,"src"],[1,"cls-fileName",3,"click"],["size","small","color","primary","name","create",3,"click",4,"ngIf"],["size","small","color","success","name","key-sharp",3,"click",4,"ngIf"],["slot","end","size","small","color","danger","name","trash",3,"click",4,"ngIf"],["size","small","color","primary","name","create",3,"click"],["size","small","color","success","name","key-sharp",3,"click"],["slot","end","size","small","color","danger","name","trash",3,"click"],[1,"d-content"],[3,"src"],[1,"somthingWrong"]],template:function(n,t){if(1&n){const o=e.RV6();e.nrm(0,"app-header-toolbar",1),e.j41(1,"ion-content",2),e.nrm(2,"ion-img",3),e.DNE(3,B,1,1,"ion-searchbar",4)(4,E,1,0,"ion-searchbar",5)(5,Y,3,2,"div",6)(6,O,3,0,"ion-fab",7)(7,z,3,1,"ion-button",8)(8,q,3,2,"ion-list",9)(9,ee,2,0,"div",10),e.j41(10,"ion-item")(11,"input",11,0),e.bIt("change",function(r){return e.eBV(o),e.Njj(t.loadImageFromDevice(r))}),e.k0s()()()}2&n&&(e.Y8G("title",t.heading)("isBackRequired",t.isBackRequired),e.R7$(2),e.Y8G("src",t.galleryImage),e.R7$(),e.Y8G("ngIf",!t.isAPiCallInProcess&&t.galleryNavs&&t.galleryNavs.length>1),e.R7$(),e.Y8G("ngIf",!t.isAPiCallInProcess&&1==t.galleryNavs.length),e.R7$(),e.Y8G("ngIf",t.isAPiCallInProcess),e.R7$(),e.Y8G("ngIf",!t.hasStudentRole),e.R7$(),e.Y8G("ngIf",!t.isAPiCallInProcess&&t.galleryNavs&&t.galleryNavs.length>1),e.R7$(),e.Y8G("ngForOf",t.data),e.R7$(),e.Y8G("ngIf",!t.isAPiCallInProcess&&t.data&&0==t.data.length))},dependencies:[y.Sq,y.bT,c.mC,c.Jm,c.b_,c.hU,c.W9,c.Q8,c.YW,c.iq,c.KW,c.uz,c.he,c.nf,c.ln,c.S1,c.ds,c.Gw,U.M],styles:[".d-content[_ngcontent-%COMP%]{display:contents}.cls-fileName[_ngcontent-%COMP%]{margin:25px}.galleryImage[_ngcontent-%COMP%]{margin-bottom:10px}#file-input[_ngcontent-%COMP%]{opacity:0;position:absolute;top:0;width:100%;height:100%;left:0;z-index:999;background-color:none}"]})}}return l})()}];let ie=(()=>{class l{static{this.\u0275fac=function(n){return new(n||l)}}static{this.\u0275mod=e.$C({type:l})}static{this.\u0275inj=e.G2t({imports:[I.iI.forChild(te),I.iI]})}}return l})();var oe=s(5075);let ne=(()=>{class l{static{this.\u0275fac=function(n){return new(n||l)}}static{this.\u0275mod=e.$C({type:l})}static{this.\u0275inj=e.G2t({imports:[y.MD,v.YN,v.X1,c.bv,ie,oe.HomePageModule]})}}return l})()}}]);