"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4096],{4096:(V,f,l)=>{l.r(f),l.d(f,{GroupmailPageModule:()=>X});var h=l(177),c=l(4341),a=l(3465),g=l(9522),G=l(467),C=l(3125),u=l(1840),d=l(1626),e=l(4438),b=l(369),j=l(6886),S=l(2571),I=l(2490),F=l(5493);const P=()=>[0,1,2,3,4,5,6,7,8,9,10];function T(n,m){if(1&n&&(e.j41(0,"ion-select-option",11),e.EFF(1),e.k0s()),2&n){const t=m.$implicit;e.Y8G("value",t.Id),e.R7$(),e.JRh(t.Description)}}function y(n,m){if(1&n){const t=e.RV6();e.j41(0,"ion-item")(1,"ion-label"),e.EFF(2,"Type "),e.j41(3,"ion-text",6),e.EFF(4,"*"),e.k0s()(),e.j41(5,"ion-select",9),e.mxI("ngModelChange",function(i){e.eBV(t);const s=e.XpG(2);return e.DH7(s.selectedTypeId,i)||(s.selectedTypeId=i),e.Njj(i)}),e.bIt("ngModelChange",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.onTypeChange())}),e.DNE(6,T,2,2,"ion-select-option",10),e.k0s()()}if(2&n){const t=e.XpG(2);e.R7$(5),e.R50("ngModel",t.selectedTypeId),e.R7$(),e.Y8G("ngForOf",t.communicatorTypes)}}function M(n,m){if(1&n&&(e.j41(0,"ion-select-option",11),e.EFF(1),e.k0s()),2&n){const t=m.$implicit;e.Y8G("value",t.FormId),e.R7$(),e.JRh(t.FormName)}}function x(n,m){if(1&n){const t=e.RV6();e.j41(0,"ion-item")(1,"ion-label"),e.EFF(2,"Template "),e.j41(3,"ion-text",6),e.EFF(4,"*"),e.k0s()(),e.j41(5,"ion-select",9),e.mxI("ngModelChange",function(i){e.eBV(t);const s=e.XpG(2);return e.DH7(s.selectedFormId,i)||(s.selectedFormId=i),e.Njj(i)}),e.DNE(6,M,2,2,"ion-select-option",10),e.k0s()()}if(2&n){const t=e.XpG(2);e.R7$(5),e.R50("ngModel",t.selectedFormId),e.R7$(),e.Y8G("ngForOf",t.formsList)}}function N(n,m){1&n&&e.EFF(0," Search Users by Lastname, Firstname, EmailId ")}function E(n,m){if(1&n){const t=e.RV6();e.j41(0,"ion-row")(1,"ion-col",4)(2,"ion-item")(3,"ion-label"),e.EFF(4,"Users"),e.k0s(),e.j41(5,"ionic-selectable",12),e.mxI("ngModelChange",function(i){e.eBV(t);const s=e.XpG(2);return e.DH7(s.userSelected,i)||(s.userSelected=i),e.Njj(i)}),e.bIt("onSearch",function(i){e.eBV(t);const s=e.XpG(2);return e.Njj(s.searchUsers(i))}),e.DNE(6,N,1,0,"ng-template",13),e.k0s()()()()}if(2&n){const t=e.XpG(2);e.R7$(5),e.R50("ngModel",t.userSelected),e.Y8G("items",t.studentList)("canSearch",!0)("isMultiple",!0)}}function R(n,m){if(1&n&&(e.j41(0,"div",16),e.EFF(1),e.k0s()),2&n){const t=m.value,o=e.XpG(3);e.R7$(),e.SpI(" ",o.formatGroups(t)," ")}}function D(n,m){if(1&n){const t=e.RV6();e.j41(0,"ion-row")(1,"ion-col",4)(2,"ion-item")(3,"ion-label"),e.EFF(4,"Groups "),e.j41(5,"ion-text",6),e.EFF(6,"*"),e.k0s()(),e.j41(7,"ionic-selectable",14),e.mxI("ngModelChange",function(i){e.eBV(t);const s=e.XpG(2);return e.DH7(s.groupsSelected,i)||(s.groupsSelected=i),e.Njj(i)}),e.bIt("onChange",function(i){e.eBV(t);const s=e.XpG(2);return e.Njj(s.groupSelectionChange(i))}),e.DNE(8,R,2,1,"ng-template",15),e.k0s()()()()}if(2&n){const t=e.XpG(2);e.R7$(7),e.R50("ngModel",t.groupsSelected),e.Y8G("items",t.groupList)("canSearch",!0)("isMultiple",!0)}}function U(n,m){if(1&n){const t=e.RV6();e.j41(0,"ion-card")(1,"ion-row")(2,"ion-col",4),e.DNE(3,y,7,2,"ion-item",2),e.k0s()(),e.j41(4,"ion-row")(5,"ion-col",4),e.DNE(6,x,7,2,"ion-item",2),e.k0s()(),e.DNE(7,E,7,4,"ion-row",2)(8,D,9,4,"ion-row",2),e.j41(9,"ion-row")(10,"ion-col",4)(11,"ion-item")(12,"ion-label",5),e.EFF(13,"Subject "),e.j41(14,"ion-text",6),e.EFF(15,"*"),e.k0s()(),e.j41(16,"ion-input",7),e.mxI("ngModelChange",function(i){e.eBV(t);const s=e.XpG();return e.DH7(s.subject,i)||(s.subject=i),e.Njj(i)}),e.k0s()()()(),e.j41(17,"ion-row")(18,"ion-col",4)(19,"ion-item")(20,"ion-label",5),e.EFF(21,"Message "),e.j41(22,"ion-text",6),e.EFF(23,"*"),e.k0s()(),e.j41(24,"ion-textarea",8),e.mxI("ngModelChange",function(i){e.eBV(t);const s=e.XpG();return e.DH7(s.message,i)||(s.message=i),e.Njj(i)}),e.k0s()()()()()}if(2&n){const t=e.XpG();e.R7$(3),e.Y8G("ngIf",t.communicatorTypes&&t.communicatorTypes.length>0),e.R7$(3),e.Y8G("ngIf",t.formsList&&t.formsList.length>0),e.R7$(),e.Y8G("ngIf",t.studentList&&t.studentList.length>0),e.R7$(),e.Y8G("ngIf",t.groupList&&t.groupList.length>0),e.R7$(8),e.R50("ngModel",t.subject),e.Y8G("disabled",t.isAPiCallInProcess),e.R7$(8),e.R50("ngModel",t.message)}}function k(n,m){1&n&&(e.j41(0,"ion-card")(1,"ion-row")(2,"ion-col",4),e.nrm(3,"ion-skeleton-text",18),e.k0s()(),e.j41(4,"ion-row")(5,"ion-col",4),e.nrm(6,"ion-skeleton-text",18),e.k0s()(),e.j41(7,"ion-row")(8,"ion-col",4),e.nrm(9,"ion-skeleton-text",18),e.k0s()(),e.j41(10,"ion-row")(11,"ion-col",4),e.nrm(12,"ion-skeleton-text",18),e.k0s()(),e.j41(13,"ion-row")(14,"ion-col",4),e.nrm(15,"ion-skeleton-text",18),e.k0s()(),e.j41(16,"ion-row",19)(17,"ion-col",20),e.nrm(18,"ion-skeleton-text",18),e.k0s()()())}function w(n,m){1&n&&(e.j41(0,"div")(1,"ion-list"),e.DNE(2,k,19,0,"ion-card",17),e.k0s()()),2&n&&(e.R7$(2),e.Y8G("ngForOf",e.lJ4(1,P)))}const v=[{path:"",component:(()=>{class n{constructor(t,o,i,s,p){this.storage=t,this.apiCall=o,this.router=i,this.commonService=s,this.loadingController=p,this.classilImage=C.l.appImages.groupmailsIl,this.heading="Group mail",this.isBackRequired=!0,this.isAPiCallInProcess=!1,this.isStudentAPiCallInProcess=!1,this.isErrorInApiCall=!1,this.isErrorInStudentApiCall=!1,this.groupMailForm=new c.gE({Subject:new c.MJ("",[c.k0.required]),body:new c.MJ("",[c.k0.required]),GroupIds:new c.MJ("",[c.k0.required]),userIds:new c.MJ("",[c.k0.required])}),i.events.subscribe(r=>{r instanceof g.wF&&("/groupmail"==r.url||"/communicator"==r.url)&&(this.ngOnInit(),"/communicator"==r.url?(this.isCommunicator=!0,this.heading="Communicator"):this.isCommunicator=!1)})}searchUsers(t){let o=t.text.trim().toLowerCase();if(t.component.startSearch(),this.usersSubscription&&this.usersSubscription.unsubscribe(),!o)return this.usersSubscription&&this.usersSubscription.unsubscribe(),t.component.items=[],void t.component.endSearch();let i=new d.Nl;i=i.append("tenantName",this.loginUserDetails.TenantShortName),i=i.append("searchVal",o),this.usersSubscription=this.apiCall.login(u.h.urls.GetUsersAsync,i).subscribe({next:s=>{this.usersSubscription.closed||(t.component.items=s,t.component.endSearch())},error:s=>{console.log("Error in Async User Search")}})}ngOnInit(){this.getGroupsList()}userSelectionChange(t){}groupSelectionChange(t){}getCommunicatorDropDowns(){this.storage.get("user").then(t=>{const o=JSON.parse(t);let i=new d.Nl;i=i.append("tenantName",o.TenantShortName),this.isAPiCallInProcess=!0,this.apiCall.login(u.h.urls.GetCommunicatorTypes,i).subscribe(s=>{this.communicatorTypes=s,this.isAPiCallInProcess=!1,this.isErrorInApiCall=!1},s=>{this.isErrorInApiCall=!0,this.isAPiCallInProcess=!1})})}onTypeChange(){let t;t=this.communicatorTypes.filter(o=>o.Id==this.selectedTypeId),t[0].Code&&""!=t[0].Code&&null!=t[0].Code?this.getFormsByType(t[0].Code):this.formsList=[]}getFormsByType(t){this.storage.get("user").then(o=>{const i=JSON.parse(o);let s=new d.Nl;s=s.append("UserID",i.UserId),s=s.append("tenantName",i.TenantShortName),s=s.append("type",t),this.isAPiCallInProcess=!0,this.apiCall.login(u.h.urls.GetFormsByType,s).subscribe(p=>{this.formsList=p,this.isAPiCallInProcess=!1,this.isErrorInApiCall=!1},p=>{this.isErrorInApiCall=!0,this.isAPiCallInProcess=!1})})}logForm(){this.storage.get("user").then(t=>{var o=(this.userSelected??[]).map(r=>r.UserId).join(","),i=(this.groupsSelected??[]).map(r=>r.GroupId).join(",");if(null==this.subject||0==this.subject.length||null==this.message&&null==this.selectedFormId||0==i.length&&0==o.length)return void this.commonService.presentToast("Please fill all the required fields",3e3,"danger");const s=JSON.parse(t);if(this.isCommunicator){let r=new d.Nl;r=r.append("tenantName",s.TenantShortName),r=r.append("UserID",s.UserId),r=r.append("Subject",this.subject),r=r.append("body",this.message),r=r.append("GroupIds",i),r=r.append("UserIds",o),r=r.append("type",this.selectedTypeId),r=r.append("formIds",this.selectedFormId),this.presentLoading(),this.apiCall.login(u.h.urls.SendCommunicator,r).subscribe(_=>{this.commonService.presentToast("Sent successfully",3e3),this.loading.dismiss(),this.commonService.systemBack()},_=>{this.loading.dismiss(),this.commonService.presentToast("Internal problem, please try again",3e3,"danger")})}else{let r=new URLSearchParams;r.append("UserID",s.UserId),r.append("tenantName",s.TenantShortName),r.append("Subject",this.subject),r.append("body",this.message),r.append("GroupIds",i),r.append("UserIds",o);let _=r.toString();this.apiCall.registerUser(u.h.urls.sendGroupMail+"?UserId="+s.UserId+"&tenantName="+s.TenantShortName+"&Subject="+this.subject+"&body="+this.message+"&GroupIds="+i+"&UserIds="+o,_).subscribe(B=>{this.commonService.presentToast("Mail send successfully",3e3),this.loading.dismiss(),this.commonService.systemBack()},B=>{this.loading.dismiss(),this.commonService.presentToast("Internal problem, please try again",3e3,"danger")})}})}formatGroups(t){return t.map(o=>o.GroupName).join(", ")}formatUsers(t){return t.map(o=>o.DisplayName).join(", ")}getGroupsList(){this.storage.get("user").then(t=>{const o=JSON.parse(t);this.loginUserDetails=o;let i=new d.Nl;i=i.append("UserID",o.UserId),i=i.append("tenantName",o.TenantShortName),this.isAPiCallInProcess=!0,this.apiCall.login(u.h.urls.getGropusList,i).subscribe({next:s=>{const p=s;this.groupList=p.GroupList,this.studentList=p.UserList,this.isCommunicator&&this.getCommunicatorDropDowns(),this.isAPiCallInProcess=!1,this.isErrorInApiCall=!1},error:s=>{this.isErrorInApiCall=!0,this.isAPiCallInProcess=!1}})})}presentLoading(){var t=this;return(0,G.A)(function*(){t.loading=yield t.loadingController.create({message:"Mail sending ...."}),yield t.loading.present()})()}static{this.\u0275fac=function(o){return new(o||n)(e.rXU(b.w),e.rXU(j.J),e.rXU(g.Ix),e.rXU(S.h),e.rXU(a.Xi))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-groupmail"]],standalone:!1,decls:7,vars:5,consts:[[3,"title","isBackRequired"],[1,"il-img","il-img-size","il-image-positin",3,"src"],[4,"ngIf"],["expand","full","type","button","color","success",3,"click"],["size","12"],["position","floating",1,"vo-form-label"],["color","danger"],["type","text",3,"ngModelChange","ngModel","disabled"],["placeholder","Enter Content...",3,"ngModelChange","ngModel"],["placeholder","Select Type",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["item-content","","itemValueField","UserId","itemTextField","DisplayName",3,"ngModelChange","onSearch","ngModel","items","canSearch","isMultiple"],["ionicSelectableMessageTemplate",""],["item-content","","itemValueField","GroupId","itemTextField","GroupName",3,"ngModelChange","onChange","ngModel","items","canSearch","isMultiple"],["ionicSelectableValueTemplate",""],[1,"ionic-selectable-value-item"],[4,"ngFor","ngForOf"],["animated","",2,"width","100%"],[2,"border-top","1px solid #ffffff"],["size","4","offset","4"]],template:function(o,i){1&o&&(e.nrm(0,"app-header-toolbar",0),e.j41(1,"ion-content"),e.nrm(2,"ion-img",1),e.DNE(3,U,25,7,"ion-card",2)(4,w,3,2,"div",2),e.j41(5,"ion-button",3),e.bIt("click",function(){return i.logForm()}),e.EFF(6,"SEND"),e.k0s()()),2&o&&(e.Y8G("title",i.heading)("isBackRequired",i.isBackRequired),e.R7$(2),e.Y8G("src",i.classilImage),e.R7$(),e.Y8G("ngIf",!i.isAPiCallInProcess),e.R7$(),e.Y8G("ngIf",i.isAPiCallInProcess))},dependencies:[h.Sq,h.bT,c.BC,c.vS,a.Jm,a.b_,a.hU,a.W9,a.KW,a.$w,a.uz,a.he,a.nf,a.ln,a.Nm,a.Ip,a.ds,a.IO,a.nc,a.Je,a.Gw,I.e,F.M],styles:[".widget-card-login-box[_ngcontent-%COMP%]{background:#fff;box-shadow:none;border:1px solid var(--ion-color-primary);color:#000}"]})}}return n})()}];let A=(()=>{class n{static{this.\u0275fac=function(o){return new(o||n)}}static{this.\u0275mod=e.$C({type:n})}static{this.\u0275inj=e.G2t({imports:[g.iI.forChild(v),g.iI]})}}return n})();var L=l(5075);let X=(()=>{class n{static{this.\u0275fac=function(o){return new(o||n)}}static{this.\u0275mod=e.$C({type:n})}static{this.\u0275inj=e.G2t({imports:[h.MD,c.YN,a.bv,A,I.e,c.X1,L.HomePageModule]})}}return n})()}}]);